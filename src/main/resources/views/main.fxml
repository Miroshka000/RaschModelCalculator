<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.control.Hyperlink?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.shape.Rectangle?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="miroshka.rasch.controller.MainController">
    <top>
        <VBox styleClass="main-header">
            <VBox styleClass="header-content" spacing="15">
                <HBox styleClass="title-row" alignment="CENTER_LEFT" spacing="20">
                    <StackPane styleClass="app-icon-container">
                        <Circle styleClass="app-icon-bg" radius="25"/>
                        <Label styleClass="app-icon-text" text="R"/>
                    </StackPane>
                    
                    <VBox spacing="5">
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <Label styleClass="app-title" text="Rasch Model Calculator"/>
                            <Label styleClass="version-badge" fx:id="versionLabel" text="v0.0.0"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="updateButton" styleClass="update-button" text="ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ" onAction="#handleCheckUpdate" visible="false"/>
                        </HBox>
                        <Label styleClass="app-subtitle" text="ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· Ð¿ÑÐ¸Ñ…Ð¾Ð¼ÐµÑ‚Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…"/>
                    </VBox>
                </HBox>
                
                <HBox styleClass="status-bar" alignment="CENTER_LEFT" spacing="15">
                    <Circle styleClass="status-indicator" fx:id="statusIndicator" radius="4"/>
                    <Label fx:id="filePathLabel" styleClass="status-label" text="Ð“Ð¾Ñ‚Ð¾Ð² Ðº Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð´Ð°Ð½Ð½Ñ‹Ñ…"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <ProgressBar fx:id="progressBar" styleClass="progress-indicator" visible="false" progress="0"/>
                </HBox>
            </VBox>
        </VBox>
    </top>
    <center>
        <ScrollPane styleClass="scroll-pane" fitToWidth="true" fitToHeight="true">
            <VBox styleClass="dashboard-container" spacing="15">
                <HBox styleClass="overview-cards" spacing="15" alignment="CENTER">
                    <StackPane styleClass="stat-card" fx:id="studentsCard">
                        <VBox styleClass="card-content" alignment="CENTER" spacing="10">
                            <Label styleClass="card-icon" text="ðŸ‘¥"/>
                            <Label styleClass="card-value" fx:id="studentsCount" text="0"/>
                            <Label styleClass="card-label" text="Ð¡Ñ‚ÑƒÐ´ÐµÐ½Ñ‚Ð¾Ð²"/>
                        </VBox>
                    </StackPane>
                    
                    <StackPane styleClass="stat-card" fx:id="itemsCard">
                        <VBox styleClass="card-content" alignment="CENTER" spacing="10">
                            <Label styleClass="card-icon" text="ðŸ“"/>
                            <Label styleClass="card-value" fx:id="itemsCount" text="0"/>
                            <Label styleClass="card-label" text="Ð—Ð°Ð´Ð°Ð½Ð¸Ð¹"/>
                        </VBox>
                    </StackPane>
                    
                    <StackPane styleClass="stat-card highlight-card" fx:id="reliabilityCard">
                        <VBox styleClass="card-content" alignment="CENTER" spacing="10">
                            <Label styleClass="card-icon" text="âš¡"/>
                            <Label styleClass="card-value" fx:id="reliabilityValue" text="--"/>
                            <Label styleClass="card-label" text="ÐÐ°Ð´ÐµÐ¶Ð½Ð¾ÑÑ‚ÑŒ"/>
                        </VBox>
                    </StackPane>
                    
                    <StackPane styleClass="stat-card" fx:id="fitCard">
                        <VBox styleClass="card-content" alignment="CENTER" spacing="10">
                            <Label styleClass="card-icon" text="ðŸŽ¯"/>
                            <Label styleClass="card-value" fx:id="fitValue" text="--"/>
                            <Label styleClass="card-label" text="Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ"/>
                        </VBox>
                    </StackPane>
                </HBox>

                <TabPane styleClass="dashboard-tabs" tabClosingPolicy="UNAVAILABLE">
                    <tabs>
                        <Tab text="ðŸ“Š Ð¡Ñ‚ÑƒÐ´ÐµÐ½Ñ‚Ñ‹">
                            <content>
                                <StackPane styleClass="tab-card">
                                    <VBox styleClass="table-section" spacing="20">
                                        <HBox styleClass="section-header" alignment="CENTER_LEFT" spacing="15">
                                            <Label styleClass="section-icon" text="ðŸ‘¨â€ðŸŽ“"/>
                                            <Label text="Ð£Ñ€Ð¾Ð²Ð½Ð¸ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ¸ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ð¾Ð²" styleClass="section-title"/>
                                            <Region HBox.hgrow="ALWAYS"/>
                                            <Button styleClass="export-mini-btn" text="ðŸ“ˆ" onAction="#handleExportPersons">
                                                <tooltip><Tooltip text="Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ð¾Ð²"/></tooltip>
                                            </Button>
                                        </HBox>
                                        
                                        <StackPane styleClass="table-wrapper">
                                            <TableView fx:id="personAbilityTable" styleClass="modern-table">
                                                <columnResizePolicy>
                                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                                </columnResizePolicy>
                                                <placeholder>
                                                    <VBox styleClass="empty-state" alignment="CENTER" spacing="15">
                                                        <Label styleClass="empty-icon" text="ðŸ“‚"/>
                                                        <Label styleClass="empty-title" text="ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…"/>
                                                        <Label styleClass="empty-subtitle" text="Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ð» Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"/>
                                                    </VBox>
                                                </placeholder>
                                            </TableView>
                                        </StackPane>
                                    </VBox>
                                </StackPane>
                            </content>
                        </Tab>
                        
                        <Tab text="ðŸ“ Ð—Ð°Ð´Ð°Ð½Ð¸Ñ">
                            <content>
                                <StackPane styleClass="tab-card">
                                    <VBox styleClass="table-section" spacing="20">
                                        <HBox styleClass="section-header" alignment="CENTER_LEFT" spacing="15">
                                            <Label styleClass="section-icon" text="ðŸ“‹"/>
                                            <Label text="Ð¢Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚Ð¸ Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹" styleClass="section-title"/>
                                            <Region HBox.hgrow="ALWAYS"/>
                                            <Button styleClass="export-mini-btn" text="ðŸ“Š" onAction="#handleExportItems">
                                                <tooltip><Tooltip text="Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹"/></tooltip>
                                            </Button>
                                        </HBox>
                                        
                                        <StackPane styleClass="table-wrapper">
                                            <TableView fx:id="itemDifficultyTable" styleClass="modern-table">
                                                <columnResizePolicy>
                                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                                </columnResizePolicy>
                                                <placeholder>
                                                    <VBox styleClass="empty-state" alignment="CENTER" spacing="15">
                                                        <Label styleClass="empty-icon" text="ðŸ“‚"/>
                                                        <Label styleClass="empty-title" text="ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…"/>
                                                        <Label styleClass="empty-subtitle" text="Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ð» Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð°Ð½Ð°Ð»Ð¸Ð·Ð°"/>
                                                    </VBox>
                                                </placeholder>
                                            </TableView>
                                        </StackPane>
                                    </VBox>
                                </StackPane>
                            </content>
                        </Tab>
                        
                        <Tab text="ðŸ—ºï¸ ÐšÐ°Ñ€Ñ‚Ð° Ð Ð°Ð¹Ñ‚Ð°">
                            <content>
                                <StackPane styleClass="tab-card">
                                    <VBox styleClass="visualization-section" spacing="20">
                                        <HBox styleClass="section-header" alignment="CENTER_LEFT" spacing="15">
                                            <Label styleClass="section-icon" text="ðŸŽ¯"/>
                                            <Label text="Item-Person Map (ÐšÐ°Ñ€Ñ‚Ð° Ð Ð°Ð¹Ñ‚Ð°)" styleClass="section-title"/>
                                            <Region HBox.hgrow="ALWAYS"/>
                                            <Button styleClass="export-mini-btn" text="ðŸ–¼ï¸" onAction="#handleExportMap">
                                                <tooltip><Tooltip text="Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ ÐºÐ°Ñ€Ñ‚Ñ‹ Ð Ð°Ð¹Ñ‚Ð°"/></tooltip>
                                            </Button>
                                        </HBox>
                                        
                                        <StackPane styleClass="visualization-wrapper" VBox.vgrow="ALWAYS">
                                            <Pane fx:id="wrightMapPane" styleClass="wright-map-canvas"/>
                                            
                                            <StackPane fx:id="mapLoadingOverlay" styleClass="loading-overlay" visible="false">
                                                <VBox alignment="CENTER" spacing="20">
                                                    <ProgressBar styleClass="loading-progress" progress="-1"/>
                                                    <Label styleClass="loading-text" text="ÐŸÐ¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ€Ñ‚Ñ‹..."/>
                                                </VBox>
                                            </StackPane>
                                        </StackPane>
                                    </VBox>
                                </StackPane>
                            </content>
                        </Tab>
                    </tabs>
                </TabPane>
            </VBox>
        </ScrollPane>
    </center>
    <bottom>
        <HBox styleClass="main-footer" alignment="CENTER" spacing="20">
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <StackPane styleClass="author-badge">
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label styleClass="author-icon" text="ðŸ’»"/>
                            <Hyperlink fx:id="githubLink" onAction="#handleGitHubLink" 
                                       text="Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾ Miroshka" styleClass="author-link"/>
                        </HBox>
                    </StackPane>
                </HBox>
                
                <Region HBox.hgrow="ALWAYS" />
                
                <HBox styleClass="action-panel" alignment="CENTER" spacing="15">
                    <Button fx:id="loadButton" onAction="#handleLoadExcel" 
                            styleClass="primary-action-btn" text="ðŸ“ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ">
                        <tooltip>
                            <Tooltip text="Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð° Excel Ð¸Ð»Ð¸ CSV" />
                        </tooltip>
                    </Button>
                    
                    <Button fx:id="exportButton" onAction="#handleExportToWord" 
                            styleClass="secondary-action-btn" text="ðŸ“„ Word">
                        <tooltip>
                            <Tooltip text="Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð² Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ Word" />
                        </tooltip>
                    </Button>
                    
                    <Button fx:id="exportAllButton" onAction="#handleExportAllData" 
                            styleClass="secondary-action-btn" text="ðŸ“Š Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚">
                        <tooltip>
                            <Tooltip text="Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð°" />
                        </tooltip>
                    </Button>
                    
                    <StackPane styleClass="exit-btn-container">
                        <Button onAction="#handleExit" styleClass="exit-button" text="âœ•">
                            <tooltip>
                                <Tooltip text="Ð’Ñ‹Ñ…Ð¾Ð´ Ð¸Ð· Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ" />
                            </tooltip>
                        </Button>
                    </StackPane>
                </HBox>
        </HBox>
    </bottom>
</BorderPane> 